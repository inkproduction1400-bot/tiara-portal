{"openapi":"3.0.0","paths":{"/api/v1/api/v1/health":{"get":{"operationId":"AppController_health","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"example":{"ok":true,"ts":"2025-01-01T00:00:00.000Z"}}}}}},"tags":["health"]}},"/api/v1/api/v1/db-ping":{"get":{"operationId":"AppController_dbPing","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"example":{"db":"ok"}}}}}},"tags":["health"]}},"/api/v1/health":{"get":{"operationId":"HealthController_check","parameters":[],"responses":{"200":{"description":"アプリの基本的な稼働情報","content":{"application/json":{"schema":{"example":{"ok":true,"ts":"2025-01-01T00:00:00.000Z","uptimeSec":123,"env":"production","version":"v1.0.0","commit":"9f8ab17136b2"}}}}}},"summary":"Basic health payload","tags":["health"]},"head":{"operationId":"HealthController_head","parameters":[],"responses":{"200":{"description":""}},"summary":"ヘルスチェック用 HEAD（200 No Content）","tags":["health"]}},"/api/v1/health/live":{"get":{"operationId":"HealthController_live","parameters":[],"responses":{"200":{"description":"常に { ok: true, ts } を返す簡易生存確認","content":{"application/json":{"schema":{"example":{"ok":true,"ts":"2025-01-01T00:00:00.000Z"}}}}}},"summary":"Liveness probe（プロセス稼働判定）","tags":["health"]}},"/api/v1/health/ready":{"get":{"operationId":"HealthController_ready","parameters":[],"responses":{"200":{"description":"DB 疎通に成功すれば { ready: true }、失敗時は { ready: false }","content":{"application/json":{"schema":{"example":{"ok":true,"ts":"2025-01-01T00:00:00.000Z","uptimeSec":456,"env":"production","version":"v1.0.0","commit":"9f8ab17136b2","ready":true}}}}}},"summary":"Readiness probe（依存疎通: DB）","tags":["health"]}},"/api/v1/health/debug-sentry":{"get":{"description":"SENTRY_DEBUG_ENABLED=1 の環境でのみエラーを投げて Sentry に送る。その他は 404。","operationId":"HealthController_debugSentry","parameters":[],"responses":{"404":{"description":"Sentry デバッグが無効"}},"summary":"Sentry エラー送信のデバッグ（保護付き）","tags":["health"]}},"/api/v1/auth/password/reset":{"post":{"operationId":"PasswordController_reset","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResetIssueDto"}}}},"responses":{"201":{"description":"成功","schema":{"example":{"ok":true,"channel":"email","token":"URL-safe-base64-token"}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IssueResetSuccessDto"}}}},"429":{"description":"クールダウン中","schema":{"example":{"statusCode":429,"message":"短時間に複数回リクエストが行われました。しばらく待ってから再度お試しく�さい。","remainingSec":96}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CooldownErrorDto"}}}}},"summary":"パスワード再設定トークンの発行","tags":["auth/password"]}},"/api/v1/auth/password/consume":{"post":{"operationId":"PasswordController_consume","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResetConsumeDto"}}}},"responses":{"201":{"description":"結果（ok=true: 成功 / ok=false: トークン無効・再利用など）","schema":{"examples":{"success":{"value":{"ok":true}},"reusedOrInvalid":{"value":{"ok":false}}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsumeResultDto"}}}}},"summary":"再設定トークンの消費（パスワード変更）","tags":["auth/password"]}},"/api/v1/applications":{"post":{"operationId":"ApplicationsController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateApplicationDto"}}}},"responses":{"201":{"description":"作成された応募のサマリを返す","content":{"application/json":{"schema":{"example":{"id":"uuid","status":"pending","receivedAt":"2025-01-01T00:00:00Z"}}}}}},"security":[{"bearer":[]}],"summary":"応募の一次受付を登録","tags":["applications"]},"get":{"operationId":"ApplicationsController_list","parameters":[{"name":"status","required":false,"in":"query","schema":{"type":"string","enum":["pending","approved","rejected"]}},{"name":"take","required":false,"in":"query","schema":{"minimum":1,"maximum":200,"default":50,"type":"number"}},{"name":"q","required":false,"in":"query","description":"簡易全文検索（メール/電話/氏名など）","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"security":[{"bearer":[]}],"summary":"応募一覧","tags":["applications"]}},"/api/v1/applications/{id}":{"get":{"operationId":"ApplicationsController_get","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"404":{"description":"application not found"}},"security":[{"bearer":[]}],"summary":"応募詳細の取得（面談票・添付含む）","tags":["applications"]}},"/api/v1/applications/{id}/approve":{"patch":{"description":"status=approved にしつつ、Application 内容から users/casts/属性/嗜好/背景を作成（既存があれば再利用）。承認後は Cast を正として Application の未入力�目を補完。","operationId":"ApplicationsController_approve","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"承認後のサマリ＋移行結果＋補完�目","content":{"application/json":{"schema":{"example":{"id":"uuid","status":"approved","approvedAt":"2025-01-01T00:00:00Z","migrated":{"mode":"created","userId":"uuid","castId":"uuid","displayName":"山田花子"},"supplementedFields":["preferredDays","preferredTimeFrom","preferredTimeTo"]}}}}},"404":{"description":"application not found"}},"security":[{"bearer":[]}],"summary":"応募を承認し、Cast を自動作成/更新","tags":["applications"]}},"/api/v1/applications/{id}/form":{"patch":{"operationId":"ApplicationsController_upsertInterviewForm","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpsertInterviewFormDto"}}}},"responses":{"200":{"description":"取り込み後の最新を返却"}},"security":[{"bearer":[]}],"summary":"面接票（登録用紙）を取り込み・更新","tags":["applications"]}},"/api/v1/applications/{id}/docs":{"post":{"operationId":"ApplicationsController_createDoc","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateApplicationDocDto"}}}},"responses":{"201":{"description":"作成（または置き換え）された添付メタ情�を返す","content":{"application/json":{"schema":{"example":{"id":"uuid","applicationId":"uuid","docType":"id_front","s3Key":"applications/<appId>/id_front.jpg","checksum":"abcd1234","uploadedAt":"2025-01-01T00:00:00Z"}}}}},"404":{"description":"application not found"}},"security":[{"bearer":[]}],"summary":"応募にファイルメタ情�を添付（身分証/自撮り/登録用紙など）","tags":["applications"]}},"/api/v1/applications/{id}/migrate-to-cast":{"post":{"description":"Application の内容をもとに users/casts/... を作成（デバッグ用）","operationId":"ApplicationsController_migrateToCast","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"201":{"description":""}},"security":[{"bearer":[]}],"summary":"応募データを Cast に移行（User/Cast/付随テーブルを生成）","tags":["applications"]}},"/api/v1/shops":{"get":{"operationId":"ShopsController_list","parameters":[],"responses":{"200":{"description":"Shop のリスト","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ShopEntity"}}}}}},"summary":"店舗一覧（キーワード付き）","tags":["shops"]},"post":{"operationId":"ShopsController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateShopDto"}}}},"responses":{"201":{"description":"作成結果","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ShopEntity"}}}},"400":{"description":"フォーマット違反（例: shopNumber が 3–4 桁でない等）","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}},"409":{"description":"ユニーク制約違反（例: shopNumber 重複）","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}}},"summary":"店舗作成（番号は自動採番／キーワードまとめて作成）","tags":["shops"]}},"/api/v1/shops/{id}":{"get":{"operationId":"ShopsController_get","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Shop の詳細","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ShopEntity"}}}},"404":{"description":"shop not found","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}}},"summary":"店舗詳細（reqKeywords を同梱）","tags":["shops"]},"patch":{"operationId":"ShopsController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateShopDto"}}}},"responses":{"200":{"description":"更新後の店舗","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ShopEntity"}}}},"400":{"description":"フォーマット違反（例: shopNumber が 3–4 桁でない等）","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}},"404":{"description":"shop not found","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}},"409":{"description":"ユニーク制約違反（例: shopNumber 重複）","content":{"application/json":{"schema":{"type":"object","required":["statusCode","message","error"],"properties":{"statusCode":{"type":"integer","example":400},"message":{"oneOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"error":{"type":"string","example":"Bad Request"}}}}}}},"summary":"店舗更新（reqKeywords 全入替）","tags":["shops"]}},"/api/v1/people/{id}":{"get":{"operationId":"PeopleController_getById","parameters":[{"name":"id","required":true,"in":"path","description":"user_id (UUID)","schema":{"type":"string"}}],"responses":{"200":{"description":"対象ユーザーのプロフィール","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["people"]},"patch":{"operationId":"PeopleController_updatePartial","parameters":[{"name":"id","required":true,"in":"path","description":"user_id (UUID)","schema":{"type":"string"}}],"responses":{"200":{"description":"部分更新後のプロフィール","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["people"]}},"/api/v1/locations":{"get":{"operationId":"LocationsController_list","parameters":[{"name":"pageSize","required":false,"in":"query","description":"1ページ件数(1～100)","schema":{"example":20}},{"name":"page","required":false,"in":"query","description":"ページ番号(1～)","schema":{"example":1}},{"name":"q","required":false,"in":"query","description":"店名などのあいまい検索","schema":{}}],"responses":{"200":{"description":"店舗一覧","content":{"application/json":{"schema":{"type":"array"}}}}},"tags":["locations"]}},"/api/v1/locations/{id}":{"get":{"operationId":"LocationsController_get","parameters":[{"name":"id","required":true,"in":"path","description":"Shop ID (UUID v4)","schema":{"example":"6fea5850-7af0-49be-93e7-7977a713674f","type":"string"}}],"responses":{"200":{"description":"店舗1件","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["locations"]},"patch":{"operationId":"LocationsController_update","parameters":[{"name":"id","required":true,"in":"path","description":"Shop ID (UUID v4)","schema":{"type":"string"}}],"responses":{"200":{"description":"店舗更新後の情�","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["locations"]}},"/api/v1/shops/{shopId}/requirements":{"get":{"operationId":"RequirementsController_get","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"ショップ要件（1:1）","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["shops/requirements"]},"put":{"operationId":"RequirementsController_upsert","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"要件のUpsert後","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["shops/requirements"]}},"/api/v1/shops/{shopId}/fixed-casts":{"get":{"operationId":"FixedCastsController_list","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"固定配属一覧","content":{"application/json":{"schema":{"type":"array"}}}}},"tags":["shops/fixed-casts"]},"post":{"operationId":"FixedCastsController_add","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"追�後の1件","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["shops/fixed-casts"]}},"/api/v1/shops/{shopId}/fixed-casts/{castId}":{"delete":{"operationId":"FixedCastsController_delete","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}},{"name":"castId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"削除結果","content":{"application/json":{"schema":{"type":"object"}}}}},"tags":["shops/fixed-casts"]}},"/api/v1/shops/{shopId}/assignments":{"get":{"operationId":"AssignmentsController_list","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}},{"name":"date","required":false,"in":"query","description":"単日指定（互換）YYYY-MM-DD。与えた�合は from/to に展開されます","schema":{"example":"2025-11-03","type":"string"}},{"name":"from","required":false,"in":"query","description":"開始時刻の下限（含む・ISO8601）","schema":{"example":"2025-11-03T00:00:00Z","type":"string"}},{"name":"to","required":false,"in":"query","description":"開始時刻の上限（未満・ISO8601）","schema":{"example":"2025-11-04T00:00:00Z","type":"string"}},{"name":"status","required":false,"in":"query","description":"ステータス（複数指定可: CSV または ?status=... を複数）","schema":{"example":"planned,assigned","type":"array","items":{"type":"string","enum":["planned","assigned","working","completed","cancelled"]}}},{"name":"castId","required":false,"in":"query","description":"キャストIDで絞り込み","schema":{"type":"string"}},{"name":"take","required":false,"in":"query","description":"取得件数（最大200）","schema":{"minimum":1,"maximum":200,"default":50,"example":50,"type":"number"}},{"name":"cursor","required":false,"in":"query","description":"カーソルID（ページング）","schema":{"type":"string"}},{"name":"order","required":false,"in":"query","description":"開始時刻の並び�","schema":{"default":"asc","type":"string","enum":["asc","desc"]}}],"responses":{"200":{"description":"フィルタ・ページング対応の一覧","content":{"application/json":{"schema":{"type":"object","properties":{"items":{"type":"array","items":{"type":"object"}},"nextCursor":{"type":"string","nullable":true}}}}}}},"tags":["Assignments"]},"post":{"operationId":"AssignmentsController_create","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"201":{"description":""}},"tags":["Assignments"]}},"/api/v1/shops/{shopId}/assignments/{id}":{"patch":{"operationId":"AssignmentsController_update","parameters":[{"name":"shopId","required":true,"in":"path","schema":{"type":"string"}},{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Assignments"]}}},"info":{"title":"Tiara API","description":"Tiara API documentation","version":"v1.0.0","contact":{}},"tags":[],"servers":[],"components":{"securitySchemes":{"bearer":{"scheme":"bearer","bearerFormat":"JWT","type":"http"}},"schemas":{"ResetIssueDto":{"type":"object","properties":{}},"IssueResetSuccessDto":{"type":"object","properties":{"ok":{"type":"boolean","example":true},"channel":{"type":"string","enum":["email","line"],"example":"email"},"token":{"type":"string","example":"URL-safe-base64-token"}},"required":["ok","channel","token"]},"CooldownErrorDto":{"type":"object","properties":{"statusCode":{"type":"number","example":429},"message":{"type":"string","example":"短時間に複数回リクエストが行われました。しばらく待ってから再度お試しく�さい。"},"remainingSec":{"type":"number","example":96,"description":"クールダウン残り秒（返らない�合もあるため optional）"}},"required":["statusCode","message"]},"ResetConsumeDto":{"type":"object","properties":{}},"ConsumeResultDto":{"type":"object","properties":{"ok":{"type":"boolean","example":true}},"required":["ok"]},"CreateApplicationDto":{"type":"object","properties":{"channel":{"type":"string","enum":["line","web","other"],"example":"line"},"email":{"type":"string","example":"user@example.com"},"phone":{"type":"string","example":"+81-90-1234-5678"},"fullName":{"type":"string","example":"山田 花子"},"drinkOk":{"type":"boolean","example":true},"genres":{"example":["ガールズバー","スナック"],"type":"array","items":{"type":"string"}},"hourlyExpectation":{"type":"number","example":2500,"description":"希望時給(円)"}},"required":["channel"]},"UpsertInterviewFormDto":{"type":"object","properties":{}},"CreateApplicationDocDto":{"type":"object","properties":{}},"ShopEntity":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"name":{"type":"string"},"shopNumber":{"type":"object","description":"呼出番号（3〜4桁、先頭ゼロ許容）","pattern":"^[0-9]{3,4}$","example":"0123","nullable":true},"prefecture":{"type":"object"},"city":{"type":"object"},"addressLine":{"type":"object"},"phone":{"type":"object"},"genre":{"type":"object"},"createdAt":{"type":"string"},"updatedAt":{"type":"string"}},"required":["id","name","createdAt","updatedAt"]},"CreateShopDto":{"type":"object","properties":{"name":{"type":"string","description":"店舗名"},"shopNumber":{"type":"string","description":"呼出番号（3〜4桁、先頭ゼロ許容）","pattern":"^[0-9]{3,4}$","example":"0123","nullable":true},"prefecture":{"type":"string","description":"都道府県","example":"福岡県","nullable":true},"city":{"type":"string","description":"市区町村","example":"福岡市","nullable":true},"addressLine":{"type":"string","description":"住所（番地以降）","example":"中央区天神1-1-1","nullable":true},"phone":{"type":"string","description":"電話番号","example":"092-000-0000","nullable":true},"genre":{"type":"string","description":"業態/ジャンル","example":"ラウンジ","nullable":true},"reqKeywords":{"description":"要望キーワード（まとめて登録、最大20件）","example":["未経験歓迎","送迎あり"],"nullable":true,"maxItems":20,"type":"array","items":{"type":"string"}}},"required":["name"]},"UpdateShopDto":{"type":"object","properties":{"name":{"type":"string","description":"店舗名","example":"Tiara 天神店","nullable":true},"shopNumber":{"type":"string","description":"呼出番号（3〜4桁、先頭ゼロ許容）","pattern":"^[0-9]{3,4}$","example":"0123","nullable":true},"prefecture":{"type":"string","description":"都道府県","example":"福岡県","nullable":true},"city":{"type":"string","description":"市区町村","example":"福岡市","nullable":true},"addressLine":{"type":"string","description":"住所（番地以降）","example":"中央区天神1-1-1","nullable":true},"phone":{"type":"string","description":"電話番号","example":"092-000-0000","nullable":true},"genre":{"type":"string","description":"業態/ジャンル","example":"ラウンジ","nullable":true},"reqKeywords":{"description":"要望キーワード（全入替・最大20件）","example":["未経験歓迎","送迎あり"],"nullable":true,"maxItems":20,"type":"array","items":{"type":"string"}}}},"ListAssignmentsDto":{"type":"object","properties":{"date":{"type":"string","description":"単日指定（互換）YYYY-MM-DD。与えた�合は from/to に展開されます","example":"2025-11-03"},"from":{"type":"string","description":"開始時刻の下限（含む・ISO8601）","example":"2025-11-03T00:00:00Z"},"to":{"type":"string","description":"開始時刻の上限（未満・ISO8601）","example":"2025-11-04T00:00:00Z"},"status":{"type":"array","description":"ステータス（複数指定可: CSV または ?status=... を複数）","example":"planned,assigned","items":{"type":"string","enum":["planned","assigned","working","completed","cancelled"]}},"castId":{"type":"string","description":"キャストIDで絞り込み"},"take":{"type":"number","description":"取得件数（最大200）","example":50,"default":50,"minimum":1,"maximum":200},"cursor":{"type":"string","description":"カーソルID（ページング）"},"order":{"type":"string","description":"開始時刻の並び�","enum":["asc","desc"],"default":"asc"}}}}}}